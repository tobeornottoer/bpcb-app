import{d as se,q as y,r as p,P as te,t as ae,i as oe,L as le,b as N,j as k,c as ne,e as _,f,g as e,k as m,p as w,F as j,z as E,C as B,w as M,y as ce,l as r,A as i,B as U,R as ie,S as de,m as z,N as re,Q as ue,E as pe,H,_ as _e}from"./index-02b6e309.js";import{u as b,a as ve,c as he,p as me}from"./awaitPayment-ff5f9902.js";import{d as ge}from"./order-2fa023db.js";import{_ as ye}from"./detail.vue_vue_type_style_index_0_lang-81632bc7.js";import"./address-ceff7901.js";import"./config-bbba5d5f.js";const d=C=>(ie("data-v-58cd9f12"),C=C(),de(),C),fe={class:"paying-module-header"},xe=d(()=>e("span",{class:"h1"},"1 Shipping address",-1)),ke=d(()=>e("div",{class:"h1 pt-[10px]"},"2 Product List",-1)),we={class:"paying-table"},be={class:"paying-table-header"},Ce={class:"min-w-[420px] name-cell"},Pe={class:"ml-0 w-[70px]"},Se=d(()=>e("div",null,"Product Name & Details",-1)),Ae=d(()=>e("div",{class:"min-w-[60px]"},"Quantity",-1)),Be=d(()=>e("div",{class:"min-w-[60px]"},"Price",-1)),Ve=d(()=>e("div",{class:"min-w-[100px]"},"Operation",-1)),Te={class:"paying-table-body"},$e={class:"checkbox-wrap mb-[5px]"},Fe={class:"ml-[8px] align-text-bottom"},Le={class:"paying-table-item"},Oe={class:"min-w-[420px]"},Ie={class:"product-detail"},Re=["onClick"],De=d(()=>e("span",{class:"text"},"Product No.: ",-1)),Ne={key:0},je=d(()=>e("span",{class:"text"},"Solder mask: ",-1)),Ee={key:1},Me=d(()=>e("span",{class:"text"},"Silkscreen: ",-1)),Ue={class:"paying-type"},ze=d(()=>e("span",{class:"text yy-time"}," Build Time: ",-1)),He=["onClick"],qe={class:"min-w-[60px]"},Qe={class:"min-w-[60px]"},Ke={class:"font-bold"},Ge={class:"text"},Je={class:"min-w-[100px]"},We={class:"paying-footer-checkbox"},Xe={class:"paying-text mt-[10px]"},Ye={class:"font-blod"},Ze={class:"paying-text text-[18px] mt-[10px]"},es={class:"font-blod text-red-600"},ss={class:"text-right btn-wrap"},ts=d(()=>e("div",{class:"paypal-icon"},null,-1)),as=se({__name:"awaitingPayment",setup(C){const q=y(()=>b().product_list);y(()=>b().product_key);const x=p(!1),c=p([]),V=y(()=>{var t;return(t=u.value)==null?void 0:t.reduce((o,l)=>o.concat(l.id),[])}),Q=a=>{var o,l,n,v,h;const t=(o=c.value)==null?void 0:o.includes(a);c.value=t?(l=c.value)==null?void 0:l.filter(A=>A!==a):(n=c.value)==null?void 0:n.concat(a),x.value=((v=c.value)==null?void 0:v.length)===((h=V.value)==null?void 0:h.length)},T=a=>{c.value=a?V.value:[]},$=p(),F=a=>{var t;(t=$.value)==null||t.open(a)},K=a=>a.type==="fpc_pcb"?a.pcb_type==="Rigid-Flex Board"?"rigid_img":"flexible_img":a.type+"_img",L=p(!1),P=p(),G=te("appMainScrollTop");ae(()=>G.value,a=>{var o,l;const t=((o=P.value)==null?void 0:o.scrollHeight)||((l=P.value)==null?void 0:l.clientHeight);L.value=!(t-a<800)});const S=y(()=>{var o;const[a,t]=((o=g.value)==null?void 0:o.split("_"))||[];return(+t||0).toFixed(2)}),J=y(()=>{var t;return((t=u.value)==null?void 0:t.reduce((o,l)=>c.value.includes(l.id)?o+=+l.price:o,0)).toFixed(2)}),O=y(()=>(+J.value+ +S.value).toFixed(2)),W=re(async()=>{var o;if(!g.value||!c.value.length)return;const a=ue.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),t=await b().getAwaitPaymentInfo({id:c.value});if(t.code===200&&t.message==="success"){const[l]=g.value.split("_"),n=await he({address_id:l,product_key:t.data.product_key});if(n.code===200&&n.message==="success"){const{order_no:v}=n.data,h=await me(v);a.close(),h.code===200&&h.message==="success"&&(window.location.href=(o=n.data)==null?void 0:o.url)}}a.close()}),X=oe(),Y=()=>{X.push("/member/address")},Z=async a=>{const{id:t}=a;pe.prompt("Please input your reason","Tip",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(async({value:o})=>{const l=await ge({order_id:t,reason:o||""});l.code===200&&l.message==="success"?(u.value=u.value.filter(n=>n.id!==t),b().deleteProductById(t),H.success("Update Successful")):H.success("Update failed")})},u=p([]),g=p(),I=p();le(async()=>{await ee();const a=await b().getAddressList();I.value=N(a)});const ee=async()=>{var t;const a=await ve();return a.code===200&&a.message==="success"&&(u.value=a.data||[],c.value=(t=q.value)==null?void 0:t.reduce((o,l)=>o.concat(l.id),[])),Promise.resolve(a)};return(a,t)=>{const o=k("el-option"),l=k("el-select"),n=k("el-checkbox"),v=k("el-button"),h=k("el-empty"),A=ne("optimize");return _(),f("div",{class:"paying-module",ref_key:"contentRef",ref:P},[e("div",fe,[xe,e("div",null,[m(l,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=s=>g.value=s),placeholder:"Please select address"},{default:w(()=>[(_(!0),f(j,null,E(I.value,s=>(_(),z(o,{value:s.id+"_"+s.freight,key:s.id,label:`${s.street}, ${s.city}, ${s.country}(${s.postal})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),e("span",{class:"add",onClick:Y},"Add a new address")])]),ke,e("div",we,[e("div",be,[e("div",Ce,[e("div",Pe,[m(n,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),onChange:T,class:"mr-[5px]"},{default:w(()=>[r("All")]),_:1},8,["modelValue"])]),Se]),Ae,Be,Ve]),e("div",Te,[u.value.length?(_(!0),f(j,{key:0},E(u.value,s=>{var R;return _(),f("div",{class:"paying-table-container",key:s.id},[e("div",$e,[m(n,{"model-value":(R=c.value)==null?void 0:R.includes(s.id),onChange:D=>Q(s.id)},null,8,["model-value","onChange"]),e("span",Fe,"Build Time: "+i(s.build_time),1)]),e("div",Le,[e("div",Oe,[e("div",{class:U([K(s),"product-img"])},null,2),e("div",Ie,[e("div",{class:"title",onClick:D=>F(s.id)},i(s.title),9,Re),e("div",null,[De,r(i(s.product_no),1)]),s.radSolderColor?(_(),f("div",Ne,[je,r(i(s.radSolderColor),1)])):B("",!0),s.radFontColor?(_(),f("div",Ee,[Me,r(i(s.radFontColor),1)])):B("",!0),e("div",Ue,"["+i(s.order_type)+"]",1),e("div",null,[ze,r(i(s.build_time),1)]),e("div",{class:"detail-view cursor-pointer",onClick:D=>F(s.id)}," Detail View ",8,He)])]),e("div",qe,i(s.quantity),1),e("div",Qe,[e("div",Ke,"$ "+i(s.price||"?"),1),e("div",Ge,"("+i(s.weight)+"kg)",1)]),e("div",Je,[M((_(),z(v,{link:"",class:"ml-0 mt-[10px] !block",type:"danger"},{default:w(()=>[r("Cancel Order")]),_:2},1024)),[[A,{event:"click",fn:Z,timeout:400,params:{id:s.id}}]])])])])}),128)):B("",!0),M(m(h,null,null,512),[[ce,!u.value.length]])])]),e("div",{class:U(["paying-footer-wrap",{"is-fixed":L.value}])},[e("div",We,[m(n,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=s=>x.value=s),onChange:T},{default:w(()=>[r("Check all")]),_:1},8,["modelValue"])]),e("div",Xe,[r(" Shipping: "),e("span",Ye,"$ "+i(+S.value?S.value:"--"),1)]),e("div",Ze,[r(" All Total: "),e("span",es,"$ "+i(+O.value?O.value:"--"),1)]),e("div",ss,[m(v,{class:"paypal-btn",type:"danger",plain:"",disabled:!c.value.length||!g.value,onClick:N(W)},{default:w(()=>[ts]),_:1},8,["disabled","onClick"])])],2),m(ye,{ref_key:"orderDetailRef",ref:$},null,512)],512)}}});const rs=_e(as,[["__scopeId","data-v-58cd9f12"]]);export{rs as default};
