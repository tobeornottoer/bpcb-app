import{a9 as Y,d as de,l as C,r as p,ab as re,Q as q,h as ue,q as pe,b as P,s as S,c as _e,e as g,f as w,g as e,v as f,x as T,F as Q,i as W,C as F,w as K,U as ve,B as _,t as c,X,p as he,k as me,y as G,a8 as ge,E as v,W as ye,ag as fe,ae as J,ah as xe,_ as we}from"./index-61481958.js";import{u as be,_ as ke,c as Ce,p as Pe}from"./pay-0b545f01.js";import{u as A}from"./awaitPayment-33aff63c.js";import{u as Se}from"./useCommon-1972965d.js";import"./config-8e92375e.js";import"./address-6fe9af1a.js";function Te(){let r=null,x=null;return{delay:V=>{r&&clearTimeout(r),r=setTimeout(()=>{x=Y.service({lock:!0,text:"Loading",background:"rgba(255, 255, 255, 0.8)"})},V)},clearDelay:()=>{r&&clearTimeout(r),x==null||x.close()}}}const d=r=>(he("data-v-8bd92cb5"),r=r(),me(),r),Ae={class:"paying-module-header"},Oe=d(()=>e("span",{class:"h1"},"1 Shipping address",-1)),Ve=d(()=>e("div",{class:"h1 pt-[10px]"},"2 Product List",-1)),Be={class:"paying-table"},De={class:"paying-table-header"},$e={class:"min-w-[420px] name-cell"},Fe={class:"ml-0 w-[70px]"},Ee=d(()=>e("div",null,"Product Name & Details",-1)),Ne=d(()=>e("div",{class:"min-w-[60px]"},"Quantity",-1)),Re=d(()=>e("div",{class:"min-w-[60px]"},"Price",-1)),Ie=d(()=>e("div",{class:"min-w-[100px]"},"Operation",-1)),Ue={class:"paying-table-body"},Le={class:"checkbox-wrap mb-[5px]"},je={class:"ml-[8px] align-text-bottom"},Me={class:"paying-table-item"},He={class:"min-w-[420px]"},ze={class:"product-detail"},qe=["onClick"],Qe=d(()=>e("span",{class:"text"},"Product No.: ",-1)),We={key:0},Ke=d(()=>e("span",{class:"text"},"Solder mask: ",-1)),Xe={key:1},Ge=d(()=>e("span",{class:"text"},"Silkscreen: ",-1)),Je={class:"paying-type"},Ye=d(()=>e("span",{class:"text yy-time"}," Build Time: ",-1)),Ze=["onClick"],es={class:"min-w-[60px]"},ss={class:"min-w-[60px]"},ts={class:"font-bold"},as={class:"text"},os={class:"min-w-[100px]"},ls={class:"paying-footer-checkbox"},ns={class:"paying-text mt-[10px]"},is={class:"font-blod"},cs={class:"paying-text text-[18px] mt-[10px]"},ds={class:"font-blod text-red-600"},rs={class:"text-right btn-wrap"},us=d(()=>e("div",{class:"paypal-icon"},null,-1)),ps=de({__name:"awaitingPayment",setup(r){const x=C(()=>A().product_list);C(()=>A().product_key);const{orderDetailRef:E,handleViewOrderdetail:O,handleProductImg:V}=Se(),b=p(!1),i=p([]),N=C(()=>{var s;return(s=m.value)==null?void 0:s.reduce((o,l)=>o.concat(l.id),[])}),Z=a=>{var o,l,n,y,u;const s=(o=i.value)==null?void 0:o.includes(a);i.value=s?(l=i.value)==null?void 0:l.filter($=>$!==a):(n=i.value)==null?void 0:n.concat(a),b.value=((y=i.value)==null?void 0:y.length)===((u=N.value)==null?void 0:u.length)},R=a=>{i.value=a?N.value:[]},I=p(!1),B=p(),ee=re("appMainScrollTop");q(()=>ee.value,a=>{var o,l;const s=((o=B.value)==null?void 0:o.scrollHeight)||((l=B.value)==null?void 0:l.clientHeight);I.value=!(s-a<800)});const h=p(),D=p(""),se=C(()=>{var s;return((s=m.value)==null?void 0:s.reduce((o,l)=>i.value.includes(l.id)?o+=+l.price:o,0)).toFixed(2)}),U=C(()=>(+se.value+ +(h.value||0)).toFixed(2)),te=ge(async()=>{var o;if(!i.value.length){v.error("Please select the order.");return}if(!k.value){v.error("Please select the shipping address");return}if(h.value===void 0||h.value===null){v.error(D.value||"Delivery address not accepted, Please reselect");return}const a=Y.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"}),s=await A().getAwaitPaymentInfo({id:i.value});if(s.code===200&&s.message==="success"){const[l]=k.value.split("_"),n=await Ce({address_id:l,product_key:s.data.product_key,freight:h.value});if(n.code===200&&n.message==="success"){const{order_no:y}=n.data,u=await Pe(y);a.close(),u.code===200&&u.message==="success"?(L(i.value.length),window.location.href=(o=u.data)==null?void 0:o.url):v.error(u.message)}else v.error(n.message)}else v.error(s.message);a.close()}),ae=ue(),oe=()=>{ae.push("/member/address")},le=async a=>{const{id:s}=a;ye.prompt("Please input your reason","Tip",{confirmButtonText:"OK",cancelButtonText:"Cancel"}).then(async({value:o})=>{const l=await fe({order_id:s,reason:o||""});l.code===200&&l.message==="success"?(m.value=m.value.filter(n=>n.id!==s),A().deleteProductById(s),L(1),v.success("Update Successful")):v.success("Update failed")})},L=a=>{J().SET_ORDER_COUNT({waiting_pay:J().order.waiting_pay-a})},m=p([]),k=p(),j=p();pe(async()=>{await ne();const a=await A().getAddressList();j.value=P(a)});const ne=async()=>{var s;const a=await be();return a.code===200&&a.message==="success"&&(m.value=a.data||[],i.value=(s=x.value)==null?void 0:s.reduce((o,l)=>o.concat(l.id),[])),Promise.resolve(a)},{delay:ie,clearDelay:ce}=Te();return q([()=>k.value,()=>i.value],async([a,s])=>{if(a&&s.length){ie(100);const[o]=a.split("_"),l=s==null?void 0:s.join(","),n=await xe({address_id:o,ids:l});h.value=n.code===200?n.data.Shipping||0:null,n.code!==200&&(v.error(n.message),D.value=n.message),ce()}else h.value=null,D.value=""}),(a,s)=>{var M;const o=S("el-option"),l=S("el-select"),n=S("el-checkbox"),y=S("el-button"),u=S("el-empty"),$=_e("optimize");return g(),w("div",{class:"paying-module",ref_key:"contentRef",ref:B},[e("div",Ae,[Oe,e("div",null,[f(l,{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=t=>k.value=t),placeholder:"Please select address"},{default:T(()=>[(g(!0),w(Q,null,W(j.value,t=>(g(),G(o,{value:t.id+"_"+t.freight,key:t.id,label:`${t.street}, ${t.city}, ${t.country}(${t.postal})`},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),e("span",{class:"add",onClick:oe},"Add a new address")])]),Ve,e("div",Be,[e("div",De,[e("div",$e,[e("div",Fe,[f(n,{modelValue:b.value,"onUpdate:modelValue":s[1]||(s[1]=t=>b.value=t),onChange:R,class:"mr-[5px]"},{default:T(()=>[_("All")]),_:1},8,["modelValue"])]),Ee]),Ne,Re,Ie]),e("div",Ue,[m.value.length?(g(!0),w(Q,{key:0},W(m.value,t=>{var H;return g(),w("div",{class:"paying-table-container",key:t.id},[e("div",Le,[f(n,{"model-value":(H=i.value)==null?void 0:H.includes(t.id),onChange:z=>Z(t.id)},null,8,["model-value","onChange"]),e("span",je,"Build Time: "+c(t.build_time),1)]),e("div",Me,[e("div",He,[e("div",{class:X([P(V)(t),"product-img"])},null,2),e("div",ze,[e("div",{class:"title",onClick:z=>P(O)(t.id)},c(t.title),9,qe),e("div",null,[Qe,_(c(t.product_no),1)]),t.radSolderColor?(g(),w("div",We,[Ke,_(c(t.radSolderColor),1)])):F("",!0),t.radFontColor?(g(),w("div",Xe,[Ge,_(c(t.radFontColor),1)])):F("",!0),e("div",Je,"["+c(t.order_type)+"]",1),e("div",null,[Ye,_(c(t.build_time),1)]),e("div",{class:"detail-view cursor-pointer",onClick:z=>P(O)(t.id)}," Detail View ",8,Ze)])]),e("div",es,c(t.quantity),1),e("div",ss,[e("div",ts,"$ "+c(t.price||"?"),1),e("div",as,"("+c(t.weight)+"kg)",1)]),e("div",os,[K((g(),G(y,{link:"",class:"ml-0 mt-[10px] !block",type:"danger"},{default:T(()=>[_("Cancel Order")]),_:2},1024)),[[$,{event:"click",fn:le,timeout:400,params:{id:t.id}}]])])])])}),128)):F("",!0),K(f(u,null,null,512),[[ve,!m.value.length]])])]),e("div",{class:X(["paying-footer-wrap",{"is-fixed":I.value}])},[e("div",ls,[f(n,{modelValue:b.value,"onUpdate:modelValue":s[2]||(s[2]=t=>b.value=t),onChange:R},{default:T(()=>[_("Check all")]),_:1},8,["modelValue"])]),e("div",ns,[_(" Shipping: "),e("span",is,"$ "+c(h.value!=null?(M=h.value)==null?void 0:M.toFixed(2):"--"),1)]),e("div",cs,[_(" All Total: "),e("span",ds,"$ "+c(+U.value?U.value:"--"),1)]),e("div",rs,[f(y,{class:"paypal-btn",type:"danger",plain:"",onClick:P(te)},{default:T(()=>[us]),_:1},8,["onClick"])])],2),f(ke,{ref_key:"orderDetailRef",ref:E},null,512)],512)}}});const fs=we(ps,[["__scopeId","data-v-8bd92cb5"]]);export{fs as default};
